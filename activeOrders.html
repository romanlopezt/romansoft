<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="UTF-8">
  <title>Sign-Up Today!</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous">

</head>

<body>

  <div class="container">

    <br>

    <!-- Jumbotron -->
    <div class="jumbotron">
      <h1 class="text-center">Ordenes Activas</h1>
    </div>
    <div class="row">

      


      <!-- Most Recent Member Card -->
      <div class="col-lg-12">
        <div class="card">
          
          <div class="card-body" id="recent-member">
            <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Phone</th>
                    <th scope="col">OrderId</th>
                    <th scope="col">Active</th>
                    <!--<th scope="col">Monthly Rate($)</th>
                    <th scope="col">Total Billed($)</th>-->
                  </tr>
                </thead>
                <tbody id="tableBody">
                  
                </tbody>
            </table>      
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>

  <!-- LINK TO FIREBASE GOES HERE -->
  <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
  <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

  <!-- Script -->
  <script>
    //  START CODING BELOW!!

    // Initialize Firebase
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyB6Qc7sKXFfP0OtslVZRO4j-u2GgJZ-KAs",
        authDomain: "dkusers-aee65.firebaseapp.com",
        databaseURL: "https://dkusers-aee65.firebaseio.com",
        projectId: "dkusers-aee65",
        storageBucket: "dkusers-aee65.appspot.com",
        messagingSenderId: "790336825855"
    };
    firebase.initializeApp(config);    
    var database = firebase.database().ref("user");
    var nombre = "";
    var telefono = "";
    var visitas = "";
    var dateAdded = "";
    

    // Firebase watcher + initial loader HINT: .on("value")
    database.once("value")
      .then(function(snapshot) {
        var content = "";
        for( let phoneNumber in snapshot.val()){
            for(let ord in snapshot.child(phoneNumber).child("/Orders").val()){
                if(snapshot.child(phoneNumber).child("/Orders").child(ord).val().activa === true){
                    console.log(`${phoneNumber} : ${snapshot.child(phoneNumber).val().nombre} : OrderId = ${ord} : Activa = ${snapshot.child(phoneNumber).child("/Orders").child(ord).val().activa}`);
                    content = `<tr id=${phoneNumber}><td>${snapshot.child(phoneNumber).val().nombre}</td><td>${phoneNumber}</td><td>${ord}</td><td>${snapshot.child(phoneNumber).child("/Orders").child(ord).val().activa}</td> <td><button class= "ordenLista" value = ${phoneNumber} id = ${ord}>Orden Lista </button></td></tr>`
                    // var TaskTitle = snapshot.child(phoneNumber).val().nombre;
                    // var telefono= phoneNumber;
                    // content += '<tr id='+ phoneNumber +'>';
                    // content += '<td>' + TaskTitle + '</td>'; //column1
                    // content += '<td>' + phoneNumber + '</td>';//column2
                    // content += '<td><button class="ordenLista" value="'+ phoneNumber +'">Orden Lista</button></td>',  
                    // content += '</tr>'; 
                    
                    $('#tableBody').append(content);
                }
                
            }
            
        }
      });
                
      //           $(".ordenLista").on("click", function(event) {
      //           // Don't refresh the page!
      //           event.preventDefault();
      //           console.log($(this).attr("value"));
      //           var id= '#'+$(this).attr("value");

      //           $(id).hide();


      // });

//  database.ref("/user").once('value', function(snapshot){
//     if(snapshot.exists()){
//         var content = '';

//         snapshot.forEach(function(data){
//             var TaskTitle = data.val().nombre;
//             var telefono= data.val().telefono;
//             content += '<tr id='+ data.val().telefono+'>';
//             content += '<td>' + TaskTitle + '</td>'; //column1
//             content += '<td>' + telefono + '</td>';//column2
//             content += '<td><button class="ordenLista" value="'+ data.val().telefono +'">Orden Lista</button></td>',  
//             content += '</tr>';
//         });

//         $('#tableBody').append(content);
//         $(".ordenLista").on("click", function(event) {
//                 // Don't refresh the page!
//                 event.preventDefault();
//                 console.log($(this).attr("value"));
//                 var id= '#'+$(this).attr("value");

//                 $(id).hide();

                
                
//                 });
//     }
// });

// /*
//         $('#tableBody').append('<tr>',
//                     '<td>'+ snapshot.val().nombre +'</td>',
//                     '<td>'+ snapshot.val().telefono +'</td>',
//                     '<td>'+ snapshot.val().visitas +'</td>',
//                     '<td>'+ moment(snapshot.val().date,'YYYY-MM-DD') +'</td>',
//                     '<td></td>',
//                     '<td></td>' ,  
//                     '<td><button class="ordenLista" value="'+ snapshot.val().telefono +'">Orden Lista</button></td>',              
//                   '</tr>');
    
// */
    

       
// // If any errors are experienced, log them to console.
// }, function(errorObject) {
// console.log("The read failed: " + errorObject.code);
// });

    // Create Error Handling

     

  </script>

</body>

</html>
